from hashlib import sha512, md5
from pwn import *
import gmpy2
context.log_level='debug'
sh = remote('47.98.156.31', 5445)

def s2h(s):
    return ''.join([hex(ord(c)).replace('0x', '') for c in s])

def h2i(s):
    return int(str(s),16)

def nonce(msg, num):
    n = 0
    msg = h2i(msg)
    j = len(str(num))
    for i in str(msg):
        i = int(i) ** int(i) * j
        d = int(str(int(i) * 987654321)[-6:])
        n += num % d
    n = (num - n**2) % d
    return n

def sign(data,x):
    data = s2h(data)
    k = nonce(data,q)
    kinv = gmpy2.invert(k,q)
    r = pow(g, k, p) % q
    h = sha512(data).hexdigest()
    h = int(h, 16)
    s = kinv * (h + r * x) % q
    return (r, int(s))


p = 31198248455472731019496739215340201911997057848114316587736933789227647718169482560810230958070804578189477351219382835524617763638444679674283860732694106535921123709020157143505759378845493643543645485243621585916026567257758724686390209844774364090557106863570579284085225367749748548340935277073521514074799620283516155381243321074955880189777530837366464771336121525352256584638514044946007673213774688190611880253588873492853744482951036316464773140620933329882218152102453349630470887781081977786889788859346884287040811643781888419852158190238918746840727700831299776696567343878267453273493961712386563291619
q = 20948050262666044906815614916146712099544774622841631794787589234359
g = 9947348980181878795045460021432558061459250728913897956997945102590350886740171571394791330584892632995503165439387886413900153587642528239561098327038430382486510419238271146265963157969008284265413784141362375985358337770707337939487121706384789363706759097209047466500616322805911811795907273855531866406327411008809923706430048352935822122291410673205412066593837036378348795368045763181748208191525066037090863027437381039691077876004532006957843442561322685709769494933660667617310844425949999387793016131076676066319826896398049265758607043258466448433981209961716741242954311079090246525605491939426268727276

r1 = 5840600993730393950800113896950810854560358719489092698068339138683
s1 = 8295967653134939854038257567528606519704316831647901915305086714748


a1 = sh.recvline(keepends=False)

salt = a1[-19:-15]
start = a1[-5:]
for i in range(1, 10000000):
    if md5(str(i) + salt).hexdigest().startswith(start):
        res = str(i)
        break

sh.sendline(res)
sh.recvline()
sh.recvline()
sh.recvline()
sh.recvline()
sh.sendline(str(2))
sh.recvline()

data = "glarcy"
k = nonce(s2h(data),q)
h = sha512(s2h(data)).hexdigest()
h = int(h, 16)

r_1 = gmpy2.invert(r1,q)
priv = r_1*(k*s1-h) % q
res = sign("admin",priv)
res = '(' + str(res[0]) + 'L, ' + str(res[1]) + 'L)'

sh.sendline(res)
sh.recvline()