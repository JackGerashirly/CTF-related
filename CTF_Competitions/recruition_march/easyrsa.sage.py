#-*- coding: utf-8 -*-


# This file was *autogenerated* from the file ../../ctf/recruition_march/easyrsa.sage
from sage.all_cmdline import *   # import sage library

_sage_const_2 = Integer(2); _sage_const_1 = Integer(1); _sage_const_0 = Integer(0); _sage_const_0x5e3e72dd3e9d633fd3b99e2303ab31b429f046765cb23be2f4f13d32652f621979e29c71df2c9fde7adf3057b8d446295da656f42e358635205b926157e322b2a31e89582015eada144134d1f5090e6b735ad0576776537436c64055dfe978cb3c150359d7e3e6b4703c9d5ffe48790991126f040d4df1517c62c88acb48e634 = Integer(0x5e3e72dd3e9d633fd3b99e2303ab31b429f046765cb23be2f4f13d32652f621979e29c71df2c9fde7adf3057b8d446295da656f42e358635205b926157e322b2a31e89582015eada144134d1f5090e6b735ad0576776537436c64055dfe978cb3c150359d7e3e6b4703c9d5ffe48790991126f040d4df1517c62c88acb48e634); _sage_const_0x10001 = Integer(0x10001); _sage_const_0xafa5236a0f7859587285161d98682d1960e7ab63f2f2687113dc3119a4c42c531e1c859c06a7a4c94615f1b3234688d4de14a87712c9c252fe2a08b80e2c3957083928dc4cebbe10453d59c9c54f36d8be1be578f31aa668cd11862b9dd4c814a18a1ea3b2a6059c4f473e998c4ffce3b18c4ef36bf84a396ac827daab441387 = Integer(0xafa5236a0f7859587285161d98682d1960e7ab63f2f2687113dc3119a4c42c531e1c859c06a7a4c94615f1b3234688d4de14a87712c9c252fe2a08b80e2c3957083928dc4cebbe10453d59c9c54f36d8be1be578f31aa668cd11862b9dd4c814a18a1ea3b2a6059c4f473e998c4ffce3b18c4ef36bf84a396ac827daab441387); _sage_const_512 = Integer(512); _sage_const_0x1f2458a57aaf9cbb2bb6045f5abf5d5d8b7556220d2740631cb9d67154d8e2b17e0670000 = Integer(0x1f2458a57aaf9cbb2bb6045f5abf5d5d8b7556220d2740631cb9d67154d8e2b17e0670000); _sage_const_16 = Integer(16); _sage_const_0p4 = RealNumber('0.4')#!/usr/bin/env sage -python
from sage.all import *
import binascii


n=_sage_const_0xafa5236a0f7859587285161d98682d1960e7ab63f2f2687113dc3119a4c42c531e1c859c06a7a4c94615f1b3234688d4de14a87712c9c252fe2a08b80e2c3957083928dc4cebbe10453d59c9c54f36d8be1be578f31aa668cd11862b9dd4c814a18a1ea3b2a6059c4f473e998c4ffce3b18c4ef36bf84a396ac827daab441387 


cipher=_sage_const_0x5e3e72dd3e9d633fd3b99e2303ab31b429f046765cb23be2f4f13d32652f621979e29c71df2c9fde7adf3057b8d446295da656f42e358635205b926157e322b2a31e89582015eada144134d1f5090e6b735ad0576776537436c64055dfe978cb3c150359d7e3e6b4703c9d5ffe48790991126f040d4df1517c62c88acb48e634 




e2 = _sage_const_0x10001 

pbits = _sage_const_512 

for i in range(_sage_const_0 ,_sage_const_2 **_sage_const_16 ):
  p4=_sage_const_0x1f2458a57aaf9cbb2bb6045f5abf5d5d8b7556220d2740631cb9d67154d8e2b17e0670000   # Remember to fill the zeros
  p4 = p4 + int(hex(i),_sage_const_16 )
  print "	[-] p4.nbits: ", p4.nbits()
  kbits = pbits - p4.nbits()  #未知需要爆破的比特位数
  p4 = p4 << kbits 
  PR = PolynomialRing(Zmod(n), names=('x',)); (x,) = PR._first_ngens(1)
  f = x + p4
  roots = f.small_roots(X=_sage_const_2 **kbits, beta=_sage_const_0p4 ) #进行爆破

  #print roots
  if roots:        #爆破成功，求根
    p = p4+int(roots[_sage_const_0 ])
    assert n % p == _sage_const_0 
    q = n/int(p)
    phin = (p-_sage_const_1 )*(q-_sage_const_1 )
    d = inverse_mod(e2,phin)
    flag = pow(cipher,d,n)
    flag = hex(int(flag))[_sage_const_2 :-_sage_const_1 ]
    print binascii.unhexlify(flag)

